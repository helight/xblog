+++
title = "scons学习笔记"
date = "2014-04-06T03:42:15+08:00"
tags = ["linux 应用"]
categories = ["linux 应用"]
banner = "img/banners/banner-2.jpg"
draft = false
author = "helight"
authorlink = "https://helight.cn"
summary = ""
keywords = ["linux 应用"]
+++

<style type="text/css"><!--
@page { margin: 0.79in }
		H1 { margin-bottom: 0.08in }
		H1.western { font-family: "Liberation Serif", serif }
		H1.cjk { font-family: "宋体" }
		H1.ctl { font-family: "DejaVu Sans" }
		P { margin-bottom: 0.08in }
		A:link { so-language: zxx }
--></style><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Arial;"> scons</span></span></span><span style="font-family: 宋体;"><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Arial;">是一个</span></span></span></span><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Arial;">python</span></span></span><span style="font-family: 宋体;"><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Arial;">写的用来编译源码的一个工具，类似于</span></span></span></span><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Arial;">make</span></span></span><span style="font-family: 宋体;"><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Arial;">工具，但是支持的语言更多，灵活性更强。</span></span></span></span>

<span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">这里来介绍一下</span></span></span></span></span><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">scons</span></span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">的使用。下载可以在其官方网站：</span></span></span></span></span><a href="http://www.scons.org/"><span style="color: #1155cc;"><span style="font-family: Arial;"><span style="font-size: medium;"><span style="text-decoration: underline;">http://www.scons.org</span></span></span></span></a><span style="font-family: 宋体;"><span style="font-size: small;"><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">，源码安装就不说了，</span></span></span></span></span><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">ubuntu</span></span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">和</span></span></span></span></span><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">debian</span></span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">上安装更为方便，直接</span></span></span></span></span><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">apt-get install scons</span></span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">就可以了。本文以编译</span></span></span></span></span><span style="color: #000000;"><span style="font-size: medium;">c</span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">、</span></span></span></span></span><span style="color: #000000;"><span style="font-size: medium;">c++</span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">为例来介绍其使用。</span></span></span></span></span>
<ol>
	<li>
<h1><span style="color: #000000;"><span style="font-family: Trebuchet MS;"><span style="font-size: large;">编译命令</span></span></span></h1>
</li>
</ol>
<span style="font-family: 宋体;"><span style="font-size: small;"><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">在源代码目录下直接使用</span></span></span></span></span><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">scons</span></span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">命令就可以编译，但是前提是编写好编译规则文件，默认的编译规则文件名是</span></span></span></span></span><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">Sconstruct</span></span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">，和</span></span></span></span></span><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">make</span></span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">的</span></span></span></span></span><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">makefile</span></span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">或者</span></span></span></span></span><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">Makefile</span></span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">文件一样。如下所示：</span></span></span></span></span>
<table width="100%" cellspacing="0" cellpadding="4"><colgroup> <col width="256*" /> </colgroup>
<tbody>
<tr>
<td valign="TOP" bgcolor="#c0c0c0" width="100%"><span style="color: #000000;"><span style="font-size: medium;">helight:stl_test$ ls </span></span><span style="color: #000000;"><span style="font-size: medium;"> deque_test.cc SConstruct</span></span></td>
</tr>
</tbody>
</table>
<span style="color: #000000;"><span style="font-size: medium;"> deque_test.cc</span><span style="font-family: Arial;"><span style="font-size: medium;">是编译源文件，</span></span><span style="font-size: medium;">SConstruct</span><span style="font-family: Arial;"><span style="font-size: medium;">是编译默认规则文件，如果没有使用默认文件名，则在编译时要用参数 </span></span><span style="font-size: medium;">-f</span><span style="font-family: Arial;"><span style="font-size: medium;">来指定规则文件，这个和</span></span><span style="font-size: medium;">make</span><span style="font-family: Arial;"><span style="font-size: medium;">是一样的。直接使用</span></span><span style="font-size: medium;">scons</span><span style="font-family: Arial;"><span style="font-size: medium;">命令编译即可，如下</span></span></span>
<table width="100%" cellspacing="0" cellpadding="4"><colgroup> <col width="256*" /> </colgroup>
<tbody>
<tr>
<td valign="TOP" bgcolor="#c0c0c0" width="100%"><span style="color: #000000;"><span style="font-size: medium;">helight:stl_test$ scons </span></span><span style="color: #000000;"><span style="font-size: medium;">scons: Reading SConscript files ... </span></span>

<span style="color: #000000;"><span style="font-size: medium;">scons: done reading SConscript files. </span></span>

<span style="color: #000000;"><span style="font-size: medium;">scons: Building targets ... </span></span>

<span style="color: #000000;"><span style="font-size: medium;">g++ -o deque_test.o -c -I. deque_test.cc </span></span>

<span style="color: #000000;"><span style="font-size: medium;">g++ -o deque_test deque_test.o -L. </span></span>

<span style="color: #000000;"><span style="font-size: medium;">scons: done building targets. </span></span>

<span style="color: #000000;"><span style="font-size: medium;">helight:stl_test$ ls </span></span>

<span style="color: #000000;"><span style="font-size: medium;">deque_test deque_test.cc deque_test.o SConstruct </span></span>

<span style="color: #000000;"><span style="font-size: medium;">helight:stl_test$</span></span></td>
</tr>
</tbody>
</table>
<span style="color: #000000;"><span style="font-size: medium;">deque_test </span><span style="font-family: Arial;"><span style="font-size: medium;">即为编译出来的二进制程序。使用</span></span><span style="font-size: medium;">scons -c </span><span style="font-family: Arial;"><span style="font-size: medium;">即可</span></span><span style="font-size: medium;">clear</span><span style="font-family: Arial;"><span style="font-size: medium;">刚刚的编译，和</span></span><span style="font-size: medium;">make clean</span><span style="font-family: Arial;"><span style="font-size: medium;">一样，只不过</span></span><span style="font-size: medium;">make clean</span><span style="font-family: Arial;"><span style="font-size: medium;">的规则要自己写或者由其他工具自动生成，</span></span><span style="font-size: medium;">scons</span><span style="font-family: Arial;"><span style="font-size: medium;">的不需要写。</span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">一般还会使用的</span></span><span style="font-size: medium;">scons</span><span style="font-family: Arial;"><span style="font-size: medium;">参数：</span></span></span>

<span style="color: #000000;"><span style="font-size: medium;">scons -Q </span><span style="font-family: Arial;"><span style="font-size: medium;">不输出</span></span><span style="font-size: medium;">scons</span><span style="font-family: Arial;"><span style="font-size: medium;">解析配置文件的信息，只显示编译命令</span></span></span>

<span style="color: #000000;"><span style="font-size: medium;">scons -s </span><span style="font-family: Arial;"><span style="font-size: medium;">不输出任何信息，静默编译</span></span></span>
<ol start="2">
	<li>
<h1><span style="color: #000000;"><span style="font-family: Trebuchet MS;"><span style="font-size: large;">编译规则文件说明</span></span></span></h1>
</li>
</ol>
<span style="font-family: 宋体;"><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Trebuchet MS;">规则文件默认文件名</span></span></span></span><span style="font-size: medium;"><span style="color: #000000;">SConstruct </span></span><span style="font-family: 宋体;"><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Arial;">，</span></span></span></span><span style="font-size: medium;"><span style="color: #000000;">SConstruct </span></span><span style="font-family: 宋体;"><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Arial;">控制编译过程和编译结果，实际上</span></span></span></span><span style="font-size: medium;"><span style="color: #000000;">SConstruct </span></span><span style="font-family: 宋体;"><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Arial;">是一个</span></span></span></span><span style="font-size: medium;"><span style="color: #000000;">python</span></span><span style="font-family: 宋体;"><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Arial;">脚本，其中可以有函数变量和一些复杂的操作过程。一般使用时里面的规则是比较简单的。</span></span></span></span><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Arial;">SConstruct </span></span></span><span style="font-family: 宋体;"><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Arial;">文件是一个类似于</span></span></span></span><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Arial;">makefile</span></span></span><span style="font-family: 宋体;"><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Arial;">一样的东西</span></span></span></span><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Arial;">, </span></span></span><span style="font-family: 宋体;"><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Arial;">告诉 </span></span></span></span><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Arial;">scons</span></span></span><span style="font-family: 宋体;"><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Arial;">做什么，而不是严格的规定</span></span></span></span><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Arial;">soncs</span></span></span><span style="font-family: 宋体;"><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Arial;">做这件事的步骤</span></span></span></span>

<span style="color: #000000;"><span style="font-size: medium;"> scons</span><span style="font-family: Arial;"><span style="font-size: medium;">支持编译多种类型的而进制文件，在</span></span><span style="font-size: medium;">c</span><span style="font-family: Arial;"><span style="font-size: medium;">、</span></span><span style="font-size: medium;">c++</span><span style="font-family: Arial;"><span style="font-size: medium;">编译中会出现的</span></span><span style="font-size: medium;">4</span><span style="font-family: Arial;"><span style="font-size: medium;">种文件，</span></span><span style="font-size: medium;">object</span><span style="font-family: Arial;"><span style="font-size: medium;">文件，可运行的二进制程序，静态库文件和动态库文件。在</span></span><span style="font-size: medium;">SConstruct</span><span style="font-family: Arial;"><span style="font-size: medium;">中也分别用以下几种变量来标示：</span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;"> Program : generate executable file</span></span><span style="font-family: 宋体;"><span style="font-size: small;">，可执行文件</span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;"> Object : generate Object file</span></span><span style="font-family: 宋体;"><span style="font-size: small;">， 编译中间文件</span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;"> Library : </span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">静态库， 也可以使用 </span></span></span></span><span style="font-family: Arial;"><span style="font-size: medium;">StaticLibrary</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">替代</span></span></span></span></span>

<span style="color: #000000;"><span style="font-size: medium;"><span style="font-family: Arial;"> SharedLibrary: </span></span><span style="font-family: 宋体;"><span style="font-size: medium;"><span style="font-family: Arial;">动态库</span></span></span></span>

<span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: medium;"><span style="font-family: Arial;">每种类型的文件编译规则都是类似的，所以就先以 </span></span></span><span style="font-size: medium;"><span style="font-family: Arial;">Program</span></span><span style="font-family: 宋体;"><span style="font-size: medium;"><span style="font-family: Arial;">文件来说明：</span></span></span></span>
<ol>
	<li><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">一般简单写法：</span></span></span>
<table width="100%" cellspacing="0" cellpadding="4"><colgroup> <col width="256*" /> </colgroup>
<tbody>
<tr>
<td valign="TOP" bgcolor="#c0c0c0" width="100%"><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">Program('hello.c')                # </span></span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">生成 </span></span></span></span></span><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">hello</span></span></span><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">Program('new_hello', 'hello.c')   # </span></span><span style="font-family: Arial;"><span style="font-size: medium;">生成 </span></span><span style="font-family: Arial;"><span style="font-size: medium;">new_hello</span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">Library("test", "deque_test.o")</span></span></span></td>
</tr>
</tbody>
</table>
</li>
	<li><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">多个文件</span></span></span>
<table width="100%" cellspacing="0" cellpadding="4"><colgroup> <col width="256*" /> </colgroup>
<tbody>
<tr>
<td valign="TOP" bgcolor="#c0c0c0" width="100%"><span style="font-family: Arial;"><span style="font-size: medium;">Program(['prog.c', 'file1.c', 'file2.c'])             # </span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">生成 </span></span></span></span><span style="font-family: Arial;"><span style="font-size: medium;">prog</span></span><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">Program('program', ['prog.c', 'file1.c', 'file2.c'])  # </span></span><span style="font-family: Arial;"><span style="font-size: medium;">生成</span></span><span style="font-family: Arial;"><span style="font-size: medium;">program</span></span></span></td>
</tr>
</tbody>
</table>
</li>
	<li><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">多个文件规则</span></span><span style="font-family: Arial;"><span style="font-size: medium;">Glob</span></span><span style="font-family: Arial;"><span style="font-size: medium;">匹配</span></span></span>
<table width="100%" cellspacing="0" cellpadding="4"><colgroup> <col width="256*" /> </colgroup>
<tbody>
<tr>
<td valign="TOP" bgcolor="#c0c0c0" width="100%">Program('program', Glob('*.c') )</td>
</tr>
</tbody>
</table>
<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">Glob</span></span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">原型为：</span></span></span></span></span><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">Glob(self, pattern, ondisk=True, source=False, strings=False)</span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">其中</span></span><span style="font-family: Arial;"><span style="font-size: medium;">pattern </span></span><span style="font-family: Arial;"><span style="font-size: medium;">支持</span></span><span style="font-family: Arial;"><span style="font-size: medium;">unix</span></span><span style="font-family: Arial;"><span style="font-size: medium;">系统下的文件名匹配： </span></span><span style="font-family: Arial;"><span style="font-size: medium;">*(</span></span><span style="font-family: Arial;"><span style="font-size: medium;">任意多个字符</span></span><span style="font-family: Arial;"><span style="font-size: medium;">), ?(</span></span><span style="font-family: Arial;"><span style="font-size: medium;">单个字符</span></span><span style="font-family: Arial;"><span style="font-size: medium;">) </span></span><span style="font-family: Arial;"><span style="font-size: medium;">和 </span></span><span style="font-family: Arial;"><span style="font-size: medium;">[](</span></span><span style="font-family: Arial;"><span style="font-size: medium;">括号中的任一字符</span></span><span style="font-family: Arial;"><span style="font-size: medium;">)</span></span></span></li>
	<li><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">使用</span></span><span style="font-family: Arial;"><span style="font-size: medium;">split</span></span><span style="font-family: Arial;"><span style="font-size: medium;">切分</span></span></span>
<table width="100%" cellspacing="0" cellpadding="4"><colgroup> <col width="256*" /> </colgroup>
<tbody>
<tr>
<td valign="TOP" bgcolor="#c0c0c0" width="100%">Program('program', <span style="color: #000000;">Split</span>('main.c file1.c file2.c'))</td>
</tr>
</tbody>
</table>
<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">Split</span></span><span style="font-family: Arial;"><span style="font-size: medium;">以空格为分隔符，将字符串分割</span></span></span></li>
	<li><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">使用关键字指明编译对象</span></span></span>
<table width="100%" cellspacing="0" cellpadding="4"><colgroup> <col width="256*" /> </colgroup>
<tbody>
<tr>
<td valign="TOP" bgcolor="#c0c0c0" width="100%">Program(target = 'hello', source = 'hello.c')</td>
</tr>
</tbody>
</table>
</li>
	<li><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">下面是一个</span></span></span>
<table width="100%" cellspacing="0" cellpadding="4"><colgroup> <col width="256*" /> </colgroup>
<tbody>
<tr>
<td valign="TOP" bgcolor="#c0c0c0" width="100%"><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;"> Object("deque_test.cc") </span></span></span><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;"> Library("test", "deque_test.o") </span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;"> SharedLibrary("test", "deque_test.cc") </span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;"> Program( </span></span></span>

<span style="color: #000000;"> <span style="font-family: Arial;"><span style="font-size: medium;"> target = 'deque_test', </span></span></span>

<span style="color: #000000;"> <span style="font-family: Arial;"><span style="font-size: medium;"> source = ["deque_test.o", "main.cc"], </span></span></span>

<span style="color: #000000;"> <span style="font-family: Arial;"><span style="font-size: medium;"> )</span></span></span></td>
</tr>
</tbody>
</table>
</li>
</ol>
<ol start="7">
	<li><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">编译过程如下：</span></span></span>
<table width="100%" cellspacing="0" cellpadding="4"><colgroup> <col width="256*" /> </colgroup>
<tbody>
<tr>
<td valign="TOP" bgcolor="#c0c0c0" width="100%"><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">helight:stl_test$ ls </span></span></span><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">deque_test.cc main.cc SConstruct </span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">helight:stl_test$ scons </span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">scons: Reading SConscript files ... </span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">scons: done reading SConscript files. </span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">scons: Building targets ... </span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">g++ -o deque_test.o -c deque_test.cc </span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">g++ -o main.o -c main.cc </span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">g++ -o deque_test deque_test.o main.o </span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">g++ -o deque_test.os -c -fPIC deque_test.cc </span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">ar rc libtest.a deque_test.o </span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">ranlib libtest.a </span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">g++ -o libtest.so -shared deque_test.os </span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">scons: done building targets. </span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">helight:stl_test$ ls </span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">deque_test deque_test.cc deque_test.o deque_test.os libtest.a libtest.so main.cc main.o SConstruct </span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">helight:stl_test$ </span></span></span></td>
</tr>
</tbody>
</table>
</li>
	<li><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">多级目录编译：</span></span></span></li>
</ol>
<table width="100%" cellspacing="0" cellpadding="4"><colgroup> <col width="256*" /> </colgroup>
<tbody>
<tr>
<td valign="TOP" bgcolor="#c0c0c0" width="100%"><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">SConscript(['test/SConstruct', 'serialize_boost/SConstruct']) #</span></span><span style="font-family: 宋体;"><span style="font-size: small;">指定多个目录下的编译文件，逐个调用执行编译</span></span></span></td>
</tr>
</tbody>
</table>
<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">其它编译相关关键字在下面一一说明</span></span></span>
<ol start="2">
	<li>
<h1><span style="color: #000000;"><span style="font-family: Trebuchet MS;"><span style="font-size: large;">编译相关关键字说明</span></span></span></h1>
</li>
</ol>
<span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: small;"><b><span style="font-family: Arial;"><span style="font-size: medium;">基本的编译关键字</span></span></b></span></span></span>
<table width="100%" cellspacing="0" cellpadding="4"><colgroup> <col width="256*" /> </colgroup>
<tbody>
<tr>
<td valign="TOP" bgcolor="#c0c0c0" width="100%"><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">CPPFLAGS  </span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">指定编译选项</span></span></span></span></span><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">LINKFLAGS </span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">指定链接选项</span></span></span></span><span style="font-family: Arial;"><span style="font-size: medium;">, </span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">如 </span></span></span></span><span style="font-family: Arial;"><span style="font-size: medium;">/DEBUG</span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">CPPDEFINES</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">指定预编译器</span></span></span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">LIBS      </span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">指定所需要链接的库文件</span></span></span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">LIBPATH   </span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">指定库文件</span></span></span></span><span style="font-family: Arial;"><span style="font-size: medium;">(.lib)</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">的搜索目录</span></span></span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">CPPPATH   </span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">指定</span></span></span></span><span style="font-family: Arial;"><span style="font-size: medium;">[.h, .c, .cpp]</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">等文件搜索路径</span></span></span></span></span></td>
</tr>
</tbody>
</table>
<span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;"><b>指定编译选项</b></span></span></span></span></span>
<table width="100%" cellspacing="0" cellpadding="4"><colgroup> <col width="256*" /> </colgroup>
<tbody>
<tr>
<td valign="TOP" bgcolor="#c0c0c0" width="100%">Program(target = 'bind_test1',

source = ["bind_test1.cc"],

LIBS = ['boost_system','boost_filesystem', 'boost_thread'],

LIBPATH = ['./', '/usr/local/lib/' ],

CPPPATH = ['./', '/usr/local/include/'],

CCGLAGS = ['-g','-O3'] ,

CPPDEFINES={'RELEASE_BUILD' : '1'}

)</td>
</tr>
</tbody>
</table>
<span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">注：</span></span></span></span><span style="font-family: Arial;"><span style="font-size: medium;">LIBS</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">和</span></span></span></span><span style="font-family: Arial;"><span style="font-size: medium;">LIBPATH</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">若为一个可以使用字符串，若为多个则使用列表</span></span></span></span></span>
<ol start="2">
	<li>
<h1><span style="font-family: 宋体;"><span style="color: #000000;"><span style="font-family: Trebuchet MS;"><span style="font-size: large;">使用</span></span></span></span><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">Environments </span></span></span></h1>
</li>
</ol>
<span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">首先，如果一个目录下有多个编译目标（多个可执行二进制或者库文件），那么上面这些编译关键字是不是要每一个都要重新指定呢</span></span><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">，这感觉上是增加了工作量，所以便有了</span></span></span></span></span><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">Environments</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">的出现，</span></span></span></span><span style="font-family: 宋体;"><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">一个</span></span></span></span></span><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">environment</span></span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">是一个影响程序执行的编译关键字值的集合，可以重复利用编译不同的目标。而环境变量也分为以下几种：</span></span></span></span></span>

<span style="color: #000000;"><b><span style="font-family: Arial;"><span style="font-size: medium;">1.</span></span></b><span style="font-family: 宋体;"><span style="font-size: small;"><b><span style="font-family: Arial;"><span style="font-size: medium;">外部环境 </span></span></b></span></span><b><span style="font-family: Arial;"><span style="font-size: medium;">External Environment</span></span></b></span>

<span style="color: #000000;"> <span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">外部环境是运行</span></span></span></span></span><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">Scons</span></span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">时 用户的环境变量。它们可以通过</span></span></span></span></span><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">os.environ</span></span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">获取，这个使用过</span></span></span></span></span><span style="color: #000000;">python<span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">或者使用</span></span></span></span></span><span style="color: #000000;">linux<span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">程序的人都知道了，这里不详细说明。</span></span></span></span></span>

<span style="color: #000000;"><b><span style="font-family: Arial;"><span style="font-size: medium;">2.</span></span></b><span style="font-family: 宋体;"><span style="font-size: small;"><b><span style="font-family: Arial;"><span style="font-size: medium;">构建环境 </span></span></b></span></span><b><span style="font-family: Arial;"><span style="font-size: medium;">Construction Environment</span></span></b></span>

<span style="color: #000000;"> <span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">它包含一些变量，这些变量会影响</span></span></span></span><span style="font-family: Arial;"><span style="font-size: medium;">Scons</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">构建目标的行为，包括编译关键字，当然还有其它一些变量。</span></span></span></span></span>

<span style="color: #000000;"> <span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">一个</span></span></span></span><span style="font-family: Arial;"><span style="font-size: medium;">Environment</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">是一个 </span></span></span></span><span style="font-family: Arial;"><span style="font-size: medium;">(name,value)</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">的集合，可以这样查看它的内容：</span></span></span></span></span>
<table width="100%" cellspacing="0" cellpadding="4"><colgroup> <col width="256*" /> </colgroup>
<tbody>
<tr>
<td valign="TOP" bgcolor="#c0c0c0" width="100%"><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env = Environment()</span></span></span><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">for item in env.Dictionary():</span></span></span>

<span style="color: #000000;">               <span style="font-family: Arial;"><span style="font-size: medium;">print '(%s:%s)' % (item, env[item])</span></span></span></td>
</tr>
</tbody>
</table>
<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">实用变量</span></span></span>
<table width="100%" cellspacing="0" cellpadding="4"><colgroup> <col width="256*" /> </colgroup>
<tbody>
<tr>
<td valign="TOP" bgcolor="#c0c0c0" width="100%"><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env['CC'] #</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">查看 </span></span></span></span><span style="font-family: Arial;"><span style="font-size: medium;">CC </span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">，即</span></span></span></span><span style="font-family: Arial;"><span style="font-size: medium;">C</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">语言编译器</span></span></span></span></span><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env.subst('$CC') # </span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">功能同上</span></span></span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env['PLATFORM'] == 'win32' #</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">判断是否是</span></span></span></span><span style="font-family: Arial;"><span style="font-size: medium;">windows: </span></span></span></td>
</tr>
</tbody>
</table>
<span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">环境变量的基本操作</span></span></span></span></span>
<table width="100%" cellspacing="0" cellpadding="4"><colgroup> <col width="256*" /> </colgroup>
<tbody>
<tr>
<td valign="TOP" bgcolor="#c0c0c0" width="100%"><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env.Clone #</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">拷贝一个环境变量，</span></span><span style="font-family: Arial;"><span style="font-size: medium;">详见</span></span></span></span><span style="font-family: Arial;"><span style="font-size: medium;">user guide 7.2.7</span></span></span><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env.Replace #</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">替换一个已经存在的环境变量</span></span></span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env.SetDefault #</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">为一个没有被定义的变量设置默认值</span></span></span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env.Append(CCFLAGS = '-option -O3 -O1') #</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">为一个已存在的环境变量增加一个值</span></span></span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env.AppendUnique #</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">为一个环境变量增加一个唯一的值</span></span></span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env.Prepend #</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">在最前边添加一个值</span></span></span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env.PrependUnique #</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">在最前边添加一个唯一的值</span></span></span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env.MergeFlags, </span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">例如：</span></span></span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">flags = {'CCFLAGS':'-option -O3 -O1'}</span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env.MergeFlags(flags)</span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">flags = {'CPPPATH' : ['/user/opt/include', 'user/local/include']}</span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env.MergeFlags(flags)</span></span></span></td>
</tr>
</tbody>
</table>
<span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">实例：</span></span></span></span></span>
<table width="100%" cellspacing="0" cellpadding="4"><colgroup> <col width="256*" /> </colgroup>
<tbody>
<tr>
<td valign="TOP" bgcolor="#c0c0c0" width="100%"><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env = Environment() # Initialize the environment </span></span></span><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env.Append(CCFLAGS = ['-g','-O3']) </span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env.Append(LIBS = ['boost_system','boost_filesystem', 'boost_thread']) </span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env.Append(CPPDEFINES={'RELEASE_BUILD' : '1'}) </span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env.Append(LIBPATH = ['/usr/local/lib/']) </span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env.Append(CPPDEFINES=['BIG_ENDIAN']) </span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env.Append(CPPPATH = ['/usr/local/include/']) </span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">#env.ParseConfig( 'pkg-config --cflags glib-2.0' ) </span></span></span>

&nbsp;

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env.Program( </span></span></span>

<span style="color: #000000;"> <span style="font-family: Arial;"><span style="font-size: medium;">target = 'test2', </span></span></span>

<span style="color: #000000;"> <span style="font-family: Arial;"><span style="font-size: medium;">source = ["test2.cc"] </span></span></span>

<span style="color: #000000;"> <span style="font-family: Arial;"><span style="font-size: medium;">) </span></span></span>

&nbsp;

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env.Program( </span></span></span>

<span style="color: #000000;"> <span style="font-family: Arial;"><span style="font-size: medium;">target = 'test3', </span></span></span>

<span style="color: #000000;"> <span style="font-family: Arial;"><span style="font-size: medium;">source = ["test3.cc"] </span></span></span>

<span style="color: #000000;"> <span style="font-family: Arial;"><span style="font-size: medium;">) </span></span></span>

&nbsp;

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env.Program( </span></span></span>

<span style="color: #000000;"> <span style="font-family: Arial;"><span style="font-size: medium;">target = 'test4', </span></span></span>

<span style="color: #000000;"> <span style="font-family: Arial;"><span style="font-size: medium;">source = ["test4.cc"] </span></span></span>

<span style="color: #000000;"> <span style="font-family: Arial;"><span style="font-size: medium;">) </span></span></span></td>
</tr>
</tbody>
</table>
<span style="color: #000000;"><b><span style="font-family: Arial;"><span style="font-size: medium;">3.</span></span></b><span style="font-family: 宋体;"><span style="font-size: small;"><b><span style="font-family: Arial;"><span style="font-size: medium;">执行环境 </span></span></b></span></span><b><span style="font-family: Arial;"><span style="font-size: medium;">Execution Environment</span></span></b></span>

<span style="color: #000000;"> <span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">执行环境用于</span></span></span></span><span style="font-family: Arial;"><span style="font-size: medium;">Scons</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">执行外部命令</span></span></span></span><span style="font-family: Arial;"><span style="font-size: medium;">(external command), </span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">以构建一个或多个目标。</span></span></span></span></span>

<span style="color: #000000;"> <span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">注意：它与外部环境不相同</span></span></span></span></span>

<span style="color: #000000;"> <span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">当</span></span></span></span></span><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">scons</span></span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">构建一个目标文件时，它所使用的外部环境和执行</span></span></span></span></span><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">scons</span></span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">时的环境变量是不同的。</span></span></span></span></span><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">scons</span></span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">使用</span></span></span></span></span><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">$ENV </span></span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">构建变量 中 存储的目录 作为它执行命令的外部环境变量。</span></span></span></span></span>

<span style="font-family: 宋体;"><span style="font-size: small;"><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">实用变量：</span></span></span></span></span><span style="color: #000000;">PATH<span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">，</span></span></span></span></span><span style="color: #000000;">path<span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">决定了库的引用，命令的寻找等。</span></span></span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;"> POSIX </span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">系统中默认的</span></span></span></span><span style="font-family: Arial;"><span style="font-size: medium;">PATH</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">是 </span></span></span></span><span style="font-family: Arial;"><span style="font-size: medium;">/user/local/bin:/user/bin</span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;"> Window</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">系统中默认的</span></span></span></span><span style="font-family: Arial;"><span style="font-size: medium;">PATH</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">是 </span></span></span></span><span style="font-family: Arial;"><span style="font-size: medium;">command interpreter</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">在注册表中的值</span></span></span></span></span>
<table width="100%" cellspacing="0" cellpadding="4"><colgroup> <col width="256*" /> </colgroup>
<tbody>
<tr>
<td valign="TOP" bgcolor="#c0c0c0" width="100%"><span style="color: #000000;">           <span style="font-family: Arial;"><span style="font-size: medium;">path = ['/user/local/bin', '/bin', '/user/bin']</span></span></span><span style="color: #000000;">           <span style="font-family: Arial;"><span style="font-size: medium;">env = Environment(ENV = {'PATH':path})</span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env = Environment(ENV = {'path' : os.environ['PATH']}) #</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">从 外部环境 初始化 </span></span></span></span><span style="font-family: Arial;"><span style="font-size: medium;">PATH</span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env = Environment(ENV = os.environ) #</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">将完整的外部变量传递给执行环境变量 这样做的缺点是：如果环境变量目录中，有多个目录包含编译器如</span></span></span></span><span style="font-family: Arial;"><span style="font-size: medium;">gcc</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">，那么 </span></span></span></span><span style="font-family: Arial;"><span style="font-size: medium;">scons</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">将执行第一个被找到的</span></span></span></span><span style="font-family: Arial;"><span style="font-size: medium;">gcc</span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env.PrependENVPath('PATH', '/user/local/bin') #</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">将</span></span></span></span><span style="font-family: Arial;"><span style="font-size: medium;">'/user/local/bin' </span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">插入 </span></span></span></span><span style="font-family: Arial;"><span style="font-size: medium;">$PATH</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">中第一个位置</span></span></span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env.AppendENVPath('lib', '/user/local/lib') #</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">将</span></span></span></span><span style="font-family: Arial;"><span style="font-size: medium;">'/user/local/bin' </span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">插入 </span></span></span></span><span style="font-family: Arial;"><span style="font-size: medium;">$LIB</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">中最后一个位置</span></span></span></span></span></td>
</tr>
</tbody>
</table>
&nbsp;
<ol start="2">
	<li>
<h1><span style="font-family: 宋体;"><span style="color: #000000;"><span style="font-family: Trebuchet MS;"><span style="font-size: large;">控制目标文件的路径</span></span></span></span></h1>
</li>
</ol>
<ol>
	<li><span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">安装目录指定：</span></span></span></span></span>&nbsp;
<table width="100%" cellspacing="0" cellpadding="4"><colgroup> <col width="256*" /> </colgroup>
<tbody>
<tr>
<td valign="TOP" bgcolor="#c0c0c0" width="100%"><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">test = env.Program('test.cpp')</span></span></span><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env.Install('bin', 'test') #</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">表示要将</span></span></span></span><span style="font-family: Arial;"><span style="font-size: medium;">test</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">放到</span></span></span></span><span style="font-family: Arial;"><span style="font-size: medium;">bin</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">目录下</span></span></span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env.Install('bin', test)</span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env.Program('bin/test', 'test.cpp')</span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env.InstallAs('bin/testapp', 'test') </span></span></span></td>
</tr>
</tbody>
</table>
</li>
</ol>
<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">2. obj</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">文件路径 </span></span></span></span></span>

<span style="color: #000000;"> <span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">使用</span></span></span></span><span style="font-family: Arial;"><span style="font-size: medium;">VariantDir</span></span><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">函数指定，具体使用见这里：</span></span></span></span><a href="http://www.scons.org/wiki/VariantDir%28%29">http://www.scons.org/wiki/VariantDir%28%29</a></span>

<span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: small;"><span style="font-family: Arial;"><span style="font-size: medium;">主要是把编译的过程文件和源文件分离，让人在编译的时候不感觉源代码路径凌乱。</span></span></span></span></span>
<span style="font-family: 宋体;"><span style="font-size: small;">如下实例：</span></span>
<table width="100%" cellspacing="0" cellpadding="4"><colgroup> <col width="256*" /> </colgroup>
<tbody>
<tr>
<td valign="TOP" bgcolor="#c0c0c0" width="100%"><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">VariantDir(".obj/", "./", duplicate=0); </span></span></span><span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env = Environment() # Initialize the environment </span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">test = Environment() # Initialize the environment </span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env.Append(CCFLAGS = ['-g','-O3']) </span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env.Append(LIBS = ['boost_system','boost_filesystem', 'boost_thread']) </span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env.Append(CPPDEFINES={'RELEASE_BUILD' : '1'}) </span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env.Append(LIBPATH = ['/usr/local/lib/']) </span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env.Append(CPPDEFINES=['BIG_ENDIAN']) </span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env.Append(CPPPATH = ['/usr/local/include/']) </span></span></span>

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">#env.ParseConfig( 'pkg-config --cflags glib-2.0' ) </span></span></span>

&nbsp;

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env.Program( </span></span></span>

<span style="color: #000000;"> <span style="font-family: Arial;"><span style="font-size: medium;">target = 'test2', </span></span></span>

<span style="color: #000000;"> <span style="font-family: Arial;"><span style="font-size: medium;">source = [".obj/test2.cc"] </span></span></span>

<span style="color: #000000;"> <span style="font-family: Arial;"><span style="font-size: medium;">) </span></span></span>

&nbsp;

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env.Program( </span></span></span>

<span style="color: #000000;"> <span style="font-family: Arial;"><span style="font-size: medium;">target = 'test3', </span></span></span>

<span style="color: #000000;"> <span style="font-family: Arial;"><span style="font-size: medium;">source = [".obj/test3.cc"] </span></span></span>

<span style="color: #000000;"> <span style="font-family: Arial;"><span style="font-size: medium;">) </span></span></span>

&nbsp;

<span style="color: #000000;"><span style="font-family: Arial;"><span style="font-size: medium;">env.Program( </span></span></span>

<span style="color: #000000;"> <span style="font-family: Arial;"><span style="font-size: medium;">target = 'test4', </span></span></span>

<span style="color: #000000;"> <span style="font-family: Arial;"><span style="font-size: medium;">source = [".obj/test4.cc"] </span></span></span>

<span style="color: #000000;"> <span style="font-family: Arial;"><span style="font-size: medium;">) </span></span></span></td>
</tr>
</tbody>
</table>
&nbsp;