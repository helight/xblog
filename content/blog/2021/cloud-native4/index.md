---
title: "云原生技术解读2-云原生运行时：容器和容器编排"
date: 2021-11-08T08:45:20+08:00
tags: ["云原生"]
categories: ["云原生", "微服务"]
banner: "img/banners/kubernetes.jpeg"
author: "helight"
authorlink: "http://helight.cn"
summary: ""
keywords: ["云原生", "微服务", "DevOps"]
draft: true
---

## 前言
9 月初给 BG 的新人开了一门课，专门来讲云原生技术，云原生技术从出现到现在按最早的时间出现来说也是有 10 多年了。尤其是这几年火热的不得了，但是 cloud native 这个外文词翻译成中文 “云原生” 就更加的不好理解，再加上本身这个词的定义在发展中又有多次的变化，导致很多学习这块技术的同学都感觉是云里雾里，不知所谓。

所以根据我对这门技术的认识，我开了这门课，一方面我认为我的认识还算比较到位，另一方面我认为目前的新人必须要学习和了解云原生技术，这是目前底层技术发展的大趋势。非常有必要学习和了解，而且我在内部也是致力于推动云原生技术的落地。在推动的过程中也很费劲，很多人看不到这场技术变革的意义和价值，这是非常让人感慨的。

## 云原生技术架构
所以我继续接着上篇解读什么是云原生。这里要接着上面篇文章中的图来继续解释，如下图
![](imgs/4.jpg)
这张图较为清晰的展示了目前云原生架构的基本层次，从最下面的运行时到最上面的应用架构，再辅助于CI/CD的持续思想以及现代变成接口方式：声明式API。层次结构都非常清晰，容易让人理解。所以下面的介绍也是围绕这个图来进行的。

## 微服务

微服务是一种软件架构方式，我们使用微服务架构可以将一个大型应用程序按照功能模块拆分成多个独立自治的微服务，每个微服务仅实现一种功能，具有明确的边界。为了让应用程序的各个微服务之间协同工作，通常需要互相调用REST等形式的标准接口进行通信和数据交换，这是一种松耦合的交互形式。

微服务基于分布式计算架构，其主要特点可以概括为如下两点。

单一职责：微服务架构中的每一个服务，都应是符合高内聚、低耦合以及单一职责原则的业务逻辑单元，不同的微服务通过REST等形式的标准接口互相调用，进行灵活的通信和组合，从而构建出庞大的系统。
独立自治性：每个微服务都应该是一个独立的组件，它可以被独立部署、测试、升级和发布，应用程序中的某个或某几个微服务被替换时，其他的微服务都不应该被影响。

基于分布式计算、可弹性扩展和组件自治的微服务，与云原生技术相辅相成，为应用程序的设计、开发和部署提供了极大便利。

简化复杂应用：微服务的单一职责原则要求一个微服务只负责一项明确的业务，相对于构建一个可以完成所有任务的大型应用程序，实现和理解只提供一个功能的小型应用程序要容易得多。每个微服务单独开发，可以加快开发速度，使服务更容易适应变化和新的需求。
简化应用部署：在单体的大型应用程序中，即使只修改某个模块的一行代码，也需要对整个系统进行重新构建、部署、测试和交付。而微服务则可以单独对某一个指定的组件进行构建、部署、测试和交付。
灵活组合：在微服务架构中，可以重用一些已有的微服务组合新的应用程序，降低应用开发成本。
可扩展性：根据应用程序中不同的微服务负载情况，可以为负载高的微服务横向扩展多个副本。
技术异构性：通常在一个大型应用程序中，不同的模块具有不同的功能特点，可能需要不同的团队使用不同的技术栈进行开发。我们可以使用任意新技术对某个微服务进行技术架构升级，只要对外提供的接口保持不变，其他微服务就不会受到影响。
高可靠性、高容错性：微服务独立部署和自治，当某个微服务出现故障时，其他微服务不受影响。

微服务具备灵活部署、可扩展、技术异构等优点，但需要一定的技术成本，而且数量众多的微服务也增加了运维的复杂度，是否采用微服务架构需要根据应用程序的特点、企业的组织架构和团队能力等多个方面来综合评估。

## 服务网格

随着微服务逐渐增多，应用程序最终可能会变为成百上千个互相调用的服务组成的大型应用程序，服务与服务之间通过内部或者外部网络进行通信。如何管理这些服务的连接关系以及保持通信通道无故障、安全、高可用和健壮，就成了一个非常大的挑战。服务网格（Service Mesh）可以作为服务间通信的基础设施层，解决上述问题。

服务网格是轻量级的网络代理，能解耦应用程序的重试/超时、监控、追踪和服务发现，并且能做到应用程序无感知。

服务网格可以使服务与服务之间的通信更加流畅、可靠、安全，它的实现通常是提供一个代理实例，和对应的服务一起部署在环境中，这种模式我们称为Sidecar模式，Sidecar模式可处理服务之间通信的任何功能，比如负载均衡、服务发现等。

服务网格的基础设施层主要分为两个部分，控制平面与数据平面，如图1-1所示。控制平面主要负责协调Sidecar的行为，提供API便于运维人员操控和测量整个网络。数据平面主要负责截获不同服务之间的调用请求并对其进行处理。

Image
▲图1-1 服务网格典型架构

与微服务架构相比，服务网格具有3个方面的优势。

可观测性：所有服务间通信都需要经过服务网格，所以在此处可以捕获所有调用相关的指标数据，如来源、目的地、协议、URL、状态码等，并通过API供运维人员观测。
流量控制：服务网格可以为服务提供智能路由、超时重试、熔断、故障注入和流量镜像等控制能力。
安全性：服务网格提供认证服务、加密服务间通信以及强制执行安全策略的能力。

## DevOps

DevOps（Development & Operations，开发和运维）是软件开发人员和IT人员之间的合作过程，是一种工作环境、文化和实践的集合，目标是高效地自动执行软件交付和基础架构更改流程。开发和运维人员通过持续不断的沟通和协作，可以以一种标准化和自动化的方式快速、频繁且可靠地交付应用。

开发人员通常以持续集成和持续交付（CI/CD）的方式，快速交付高质量的应用程序。持续集成是指开发人员频繁地将开发分支代码合并到主干分支，这些开发分支在真正合并到主干分支之前，都需要持续编译、构建和测试，以提前检查和验证其存在的缺陷。持续集成的本质是确保开发人员新增的代码与主干分支正确集成。

持续交付是指软件产品可以稳定、持续地保持随时可发布的状态，它的目标是促进产品迭代更频繁，持续为用户创造价值。与持续集成关注代码构建和集成相比，持续交付关注的是可交付的产物。

持续集成只是对新代码与原有代码的集成做了检查和测试，在可交付的产物真正交付至生产环境之前，我们一般还需要将其部署至测试环境和预发布环境，进行充分的集成测试和验证，最后才会交付至生产环境，保证新增代码在生产环境中稳定可用。

使用持续集成和持续交付的优势如下。

避免重复性劳动，减少人工操作的错误：自动化部署可以将开发运维人员从应用程序集成、测试和部署等重复性劳动环节中解放出来，而且人工操作容易犯错，机器犯错的概率则非常小。
提前发现问题和缺陷：持续集成和持续交付能让开发和运维人员更早地获取应用程序的变更情况，更早地进入测试和验证阶段，也就能更早地发现和解决问题。
更频繁的迭代：持续集成和持续交付缩短了从开发、集成、测试、部署到交付各个环节的时间，中间有任何问题都可以快速“回炉”改造和更新，整个过程敏捷且可持续，大大提高了应用程序的迭代频率和效率。
更高的产品质量：持续集成可以结合代码预览、代码质量检查等功能，对不规范的代码进行标识和通知；持续交付可以在产品上线前充分验证应用可能存在的缺陷，最终提供给用户一款高质量的产品。

云原生应用通常包含多个子功能组件，DevOps可以大大简化云原生应用从开发到交付的过程，实现真正的价值交付。

Image


## 声明式API

声明式设计是一种软件设计理念：我们负责描述一个事物想要达到的目标状态并将其提交给工具，由工具内部去处理如何实现目标状态。

与声明式设计相对应的是过程式设计。在过程式设计中，我们需要描述为了让事物达到目标状态的一系列操作，这一系列的操作只有都被正确执行，才会达到我们期望的最终状态。

在声明式API中，我们需要向系统声明我们期望的状态，系统会不断地向该状态驱动。在Kubernetes中，声明式API指的就是集群期望的运行状态，如果有任何与期望状态不一致的情况，Kubernetes就会根据声明做出对应的合适的操作。使用声明式API的好处可以总结为以下两点。

声明式API能够使系统更加健壮，当系统中的组件出现故障时，组件只需要查看API服务器中存储的声明状态，就可以确定接下来需要执行的操作。

声明式API能够减少开发和运维人员的工作量，极大地提升工作效率。



<center>
看完本文有收获？请分享给更多人

关注「黑光技术」，关注大数据+微服务

![](/img/qrcode_helight_tech.jpg)

</center>